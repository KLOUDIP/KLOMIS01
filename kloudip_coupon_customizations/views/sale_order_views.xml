<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="sale_order_view_form" model="ir.ui.view">
        <field name="name">sale.order.view.form.inherit.kloudip_coupon_customizations</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale_loyalty.sale_order_view_form_inherit_sale_loyalty"/>
        <field name="arch" type="xml">

            <!--change action in sale coupon apply code wizard view button-->
            <xpath expr="//button[@name='%(sale_loyalty.sale_loyalty_coupon_wizard_action)d']" position="attributes">
                <attribute name="name">action_open_sale_loyalty_coupon_wizard</attribute>
                <attribute name="type">object</attribute>
            </xpath>

            <xpath expr="//header" position="inside">
                <button name="create_voucher_deposit" string="Deposit Advice" type="object" class="btn-primary" attrs="{'invisible': ['|', ('coupon_count', '=', 0), ('invoice_status', '!=', 'to invoice')]}" context="{'create_voucher_deposit': True}"/>
                <button name="create_voucher_deposit" string="Deposit Advice" type="object" attrs="{'invisible': ['|', ('coupon_count', '>', 0), ('invoice_status', '!=', 'no')]}" context="{'create_voucher_deposit': True}"/>
            </xpath>

            <!--Replacing context for the button cause some errors so we open wizard from python action-->
            <button name="%(sale.action_view_sale_advance_payment_inv)d" position="attributes">
                <attribute name="name">action_open_sale_make_invoice_advance_wizard</attribute>
                <attribute name="type">object</attribute>
            </button>

            <!--Adding custom statinfo buttons-->
            <div name="button_box" position="inside">
                <button name="action_view_assigned_coupons" type="object" class="oe_stat_button" icon="fa-ticket" attrs="{'invisible': [('coupon_count', '=', 0)]}">
                    <field name="coupon_count" widget="statinfo" string="Vouchers"/>
                </button>
            </div>

            <div name="button_box" position="inside">
                <field name="generated_coupon_count" invisible="1"/>
                <button name="action_view_generated_coupons" type="object" class="oe_stat_button" icon="fa-ticket" attrs="{'invisible': [('generated_coupon_count', '=', 0)]}">
                    <field name="generated_coupon_count" widget="statinfo" string="Vouchers"/>
                </button>
            </div>

        </field>
    </record>

</odoo>